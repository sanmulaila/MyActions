name: Daily Checkin

on:
  workflow_dispatch:
  schedule:
    - cron: "0 2,14 * * *" # 16:00 -> 00:00

env:
  TZ: Asia/Shanghai
  CHECK_JSON: ${{ secrets.CHECK_JSON }}
  TG_BOT_TOKEN: 1956279314:AAHxGyt1owBsFFVwKri3_liP8SOd7tabvnw
  TG_USER_ID: 799728773

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.x"]
    steps:
      - name: Checkout Codes
        uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
          architecture: "x64"
      # - name: Daily Checkin
      #   run: bash checkin.sh
      - name: Telegram Message
        run: |
          title="<strong>MyActions Update ⚠️</strong>\n\n"
          repo="https://github.com/JaimeZeng/MyActions"
          author="$(git log -1 --pretty=format:'%cn')"
          date="$(git log -1 --pretty=format:'%ci')"
          hash="$(git log -1 --pretty=format:'%h')"
          files="$(git log -1 --name-status --format='')" 
          commitLink="https://github.com/JaimeZeng/MyActions/commit/$(git log -1 --pretty=format:'%H')"
          file="\n"
          fileLink="https://github.com/JaimeZeng/MyActions/blob/main/"
          for var in $(echo "${files}" | cut -f2)
          do
              file="${file}    ▫ <a href='${fileLink}${var}'> ${var} </a>\n"
          done
          message="" 
          message="${title}🔸 提交: ${repo}\n" 
          message="${message}🔸 提交者: ${author}\n" 
          message="${message}🔸 提交时间: ${date}\n" 
          message="${message}🔸 提交哈希值: ${hash}\n" 
          message="${message}🔸 具体提交信息: <a href='${commitLink}'> 👉🏻 Github </a>\n" 
          message="${message}🔸 提交变动文件: ${file}\n\n"
          message="${message} ➖➖➖➖➖➖➖➖"
          message="${message} <img src='https://wttr.in/%E9%9B%81%E5%A1%94%E5%8C%BA.png?lang=zh' alt='smile' />"
          message="${message} <img src='https://wttr.in/%E6%99%AF%E6%B3%B0%E5%8E%BF.png?lang=zh' alt='smile' />"
          echo "${message}" > message.txt
      - name: Send telegram message
        uses: appleboy/telegram-action@master
        with:
          to: 799728773
          token: 1956279314:AAHxGyt1owBsFFVwKri3_liP8SOd7tabvnw
          message_file: message.txt
          format: html
          disable_web_page_preview: true
